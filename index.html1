<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMPN 58 PLG - Sistem Manajemen Sekolah</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        .animate-slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .animate-bounce-in {
            animation: bounceIn 0.6s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .hover-lift {
            transition: all 0.3s ease;
        }
        
        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .sidebar-transition {
            transition: transform 0.3s ease-in-out;
        }
        
        .status-hadir { background-color: #10b981; }
        .status-sakit { background-color: #f59e0b; }
        .status-izin { background-color: #3b82f6; }
        .status-alfa { background-color: #ef4444; }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 16px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen">
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <div id="loginPage" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-gray-900 via-purple-900 to-violet-900">
        <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl w-full max-w-md animate-bounce-in">
            <div class="text-center mb-8">
                <i class="fas fa-graduation-cap text-5xl text-purple-400 mb-4"></i>
                <h1 class="text-3xl font-bold text-white mb-2">SMPN 58 PLG</h1>
                <p class="text-gray-400">Sistem Manajemen Sekolah</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="username" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300" placeholder="Masukkan username">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-300" placeholder="Masukkan password">
                </div>
                <button type="submit" class="w-full btn-primary text-white py-3 rounded-lg font-semibold">
                    <i class="fas fa-sign-in-alt mr-2"></i>Masuk
                </button>
            </form>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <header class="bg-gray-800 shadow-lg sticky top-0 z-40">
            <div class="flex items-center justify-between px-6 py-4">
                <div class="flex items-center space-x-4">
                    <button id="sidebarToggle" class="text-gray-300 hover:text-white transition-colors duration-200 p-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <h1 id="pageTitle" class="text-xl font-semibold text-white">Beranda</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-gray-300">SMPN 58 PLG</span>
                    <i class="fas fa-graduation-cap text-purple-400 text-2xl"></i>
                </div>
            </div>
        </header>

        <aside id="sidebar" class="fixed left-0 top-0 h-full w-64 bg-gray-800 bg-opacity-95 backdrop-blur-md shadow-xl z-50 sidebar-transition transform -translate-x-full">
            <div class="p-6 border-b border-gray-700 border-opacity-50">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <i class="fas fa-graduation-cap text-3xl text-purple-400"></i>
                        <div>
                            <h2 class="text-lg font-bold text-white">SMPN 58 PLG</h2>
                            <p class="text-sm text-gray-400">Admin Panel</p>
                        </div>
                    </div>
                    <button id="sidebarClose" class="text-gray-400 hover:text-white transition-colors duration-200 p-2 rounded-lg hover:bg-gray-700">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>
            
            <nav class="mt-6">
                <a href="#" onclick="showPage('beranda')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-home mr-3"></i>Beranda
                </a>
                <a href="#" onclick="showPage('agenda-guru')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-calendar-alt mr-3"></i>Agenda Guru
                </a>
                <a href="#" onclick="showPage('jurnal-guru')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-book mr-3"></i>Jurnal Guru
                </a>
                <a href="#" onclick="showPage('absensi')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-user-check mr-3"></i>Absensi
                </a>
                <a href="#" onclick="showPage('siswa')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-users mr-3"></i>Data Siswa
                </a>
                <a href="#" onclick="showPage('penilaian')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-star mr-3"></i>Penilaian
                </a>
                <a href="#" onclick="showPage('rekapan')" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-gray-700 hover:bg-opacity-70 hover:text-white transition-all duration-200">
                    <i class="fas fa-chart-bar mr-3"></i>Rekapan
                </a>
                <a href="#" onclick="logout()" class="nav-item flex items-center px-6 py-3 text-gray-300 hover:bg-red-600 hover:bg-opacity-80 hover:text-white transition-all duration-200">
                    <i class="fas fa-sign-out-alt mr-3"></i>Logout
                </a>
            </nav>
            
            <div class="absolute bottom-4 left-0 right-0 px-6">
                <p class="text-xs text-gray-500 text-center">© 2025 Aris Bermansyah, S.Kom</p>
            </div>
        </aside>

        <main id="mainContent" class="p-6 transition-all duration-300">
            <div id="berandaPage" class="page-content">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Selamat Datang</h2>
                    <p class="text-gray-400">Sistem Manajemen Sekolah SMPN 58 Palembang</p>
                    <p class="text-xs text-gray-500">© 2025 Aris Bermansyah, S.Kom</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div onclick="showPage('agenda-guru')" class="bg-gradient-to-br from-blue-600 to-blue-800 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-calendar-alt text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Agenda Guru</h3>
                        <p class="text-blue-100">Kelola agenda dan jadwal mengajar</p>
                    </div>
                    
                    <div onclick="showPage('jurnal-guru')" class="bg-gradient-to-br from-green-600 to-green-800 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-book text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Jurnal Guru</h3>
                        <p class="text-green-100">Catat kegiatan pembelajaran harian</p>
                    </div>
                    
                    <div onclick="showPage('siswa')" class="bg-gradient-to-br from-indigo-600 to-indigo-800 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-users text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Data Siswa</h3>
                        <p class="text-indigo-100">Kelola data siswa per kelas</p>
                    </div>
                    
                    <div onclick="showPage('absensi')" class="bg-gradient-to-br from-purple-600 to-purple-800 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-user-check text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Absensi</h3>
                        <p class="text-purple-100">Kelola kehadiran siswa</p>
                    </div>
                    
                    <div onclick="showPage('penilaian')" class="bg-gradient-to-br from-yellow-600 to-orange-600 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-star text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Penilaian</h3>
                        <p class="text-yellow-100">Input dan kelola nilai siswa</p>
                    </div>
                    
                    <div onclick="showPage('rekapan')" class="bg-gradient-to-br from-red-600 to-pink-600 p-6 rounded-xl shadow-lg hover-lift cursor-pointer">
                        <i class="fas fa-chart-bar text-4xl text-white mb-4"></i>
                        <h3 class="text-xl font-semibold text-white mb-2">Rekapan</h3>
                        <p class="text-red-100">Lihat laporan dan statistik</p>
                    </div>
                </div>
            </div>

            <div id="agendaGuruPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Agenda Guru</h2>
                    <p class="text-gray-400">Kelola agenda dan jadwal mengajar</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <h3 class="text-xl font-semibold text-white mb-6">Tambah Agenda Baru</h3>
                    <form id="agendaForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Tanggal</label>
                            <input type="date" id="agendaTanggal" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Waktu</label>
                            <input type="time" id="agendaWaktu" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Mata Pelajaran</label>
                            <select id="agendaMapel" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="Informatika">Informatika</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                            <select id="agendaKelas" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Materi/Kegiatan</label>
                            <textarea id="agendaMateri" rows="3" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Deskripsi materi atau kegiatan"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jenis Kegiatan</label>
                            <select id="agendaJenis" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="Pembelajaran">Pembelajaran</option>
                                <option value="Ulangan">Ulangan</option>
                                <option value="Praktikum">Praktikum</option>
                                <option value="Diskusi">Diskusi</option>
                                <option value="Presentasi">Presentasi</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                                <span class="btn-text"><i class="fas fa-plus mr-2"></i>Tambah Agenda</span>
                                <span class="btn-loading hidden"><div class="loading mr-2"></div>Menyimpan...</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-white mb-6">Daftar Agenda</h3>
                    <div id="agendaList" class="space-y-4">
                        </div>
                </div>
            </div>

            <div id="jurnalGuruPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Jurnal Guru</h2>
                    <p class="text-gray-400">Catat kegiatan pembelajaran harian</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <h3 class="text-xl font-semibold text-white mb-6">Tambah Jurnal Baru</h3>
                    <form id="jurnalForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Tanggal</label>
                            <input type="date" id="jurnalTanggal" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jam Ke</label>
                            <select id="jurnalJam" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                                <option value="9">9</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Mata Pelajaran</label>
                            <select id="jurnalMapel" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="Informatika">Informatika</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                            <select id="jurnalKelas" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Materi yang Diajarkan</label>
                            <textarea id="jurnalMateri" rows="3" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Deskripsi materi yang diajarkan"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jumlah Siswa Hadir</label>
                            <input type="number" id="jurnalHadir" min="0" max="40" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jumlah Siswa Tidak Hadir</label>
                            <input type="number" id="jurnalTidakHadir" min="0" max="40" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-300 mb-2">Catatan/Kendala (Opsional)</label>
                            <textarea id="jurnalCatatan" rows="3" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Catatan atau kendala yang dihadapi"></textarea>
                        </div>
                        <div class="md:col-span-2">
                            <button type="submit" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                                <span class="btn-text"><i class="fas fa-plus mr-2"></i>Tambah Jurnal</span>
                                <span class="btn-loading hidden"><div class="loading mr-2"></div>Menyimpan...</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-white mb-6">Daftar Jurnal</h3>
                    <div id="jurnalList" class="space-y-4">
                        </div>
                </div>
            </div>

            <div id="siswaPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Data Siswa</h2>
                    <p class="text-gray-400">Kelola data siswa per kelas</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <h3 class="text-xl font-semibold text-white mb-6">Tambah Siswa Baru</h3>
                    <form id="siswaForm" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Nama Lengkap</label>
                            <input type="text" id="namaSiswa" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Nama lengkap siswa">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                            <select id="kelasSiswa" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                        </div>
                        <div>
                            <button type="submit" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold mt-6">
                                <span class="btn-text"><i class="fas fa-plus mr-2"></i>Tambah Siswa</span>
                                <span class="btn-loading hidden"><div class="loading mr-2"></div>Menyimpan...</span>
                            </button>
                        </div>
                    </form>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                        <h3 class="text-xl font-semibold text-white">Filter Data Siswa</h3>
                        <div class="flex flex-wrap items-center gap-4">
                            <select id="filterKelas" class="px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white">
                                <option value="">Semua Kelas</option>
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                            <button onclick="loadDataSiswa()" class="btn-primary px-4 py-2 rounded-lg text-white">
                                <i class="fas fa-search mr-2"></i>Filter
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-white mb-6">Daftar Siswa</h3>
                    <div id="siswaList" class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="p-3 text-gray-300">No</th>
                                    <th class="p-3 text-gray-300">Nama Siswa</th>
                                    <th class="p-3 text-gray-300">Kelas</th>
                                    <th class="p-3 text-gray-300">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="siswaTableBody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="absensiPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Absensi Siswa</h2>
                    <p class="text-gray-400">Kelola kehadiran siswa</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jenis Absen</label>
                            <select id="jenisAbsen" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="Wali Kelas">Wali Kelas</option>
                                <option value="Guru Mapel">Guru Mapel</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                            <select id="kelasAbsen" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Tanggal</label>
                            <input type="date" id="tanggalAbsen" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        </div>
                    </div>
                    <button onclick="loadAbsensi()" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold mb-6">
                        <i class="fas fa-search mr-2"></i>Muat Data Siswa
                    </button>
                </div>
                
                <div id="absensiContainer" class="bg-gray-800 rounded-xl p-6 hidden">
                    <div class="flex flex-col md:flex-row md:justify-between md:items-center gap-4 mb-6">
                        <h3 class="text-xl font-semibold text-white">Daftar Siswa</h3>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="hadirSemua()" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg text-white font-semibold transition-colors duration-200">
                                <i class="fas fa-check-double mr-2"></i>Hadir Semua
                            </button>
                            <button onclick="simpanAbsensi()" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                                <span class="btn-text"><i class="fas fa-save mr-2"></i>Simpan Absensi</span>
                                <span class="btn-loading hidden"><div class="loading mr-2"></div>Menyimpan...</span>
                            </button>
                        </div>
                    </div>
                    <div id="siswaGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        </div>
                </div>
            </div>

            <div id="penilaianPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Penilaian Siswa</h2>
                    <p class="text-gray-400">Input dan kelola nilai siswa</p>
                </div>
                
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                            <select id="kelasPenilaian" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="7.1">7.1</option>
                                <option value="7.2">7.2</option>
                                <option value="7.3">7.3</option>
                                <option value="7.4">7.4</option>
                                <option value="8.1">8.1</option>
                                <option value="8.2">8.2</option>
                                <option value="8.3">8.3</option>
                                <option value="8.4">8.4</option>
                                <option value="9.1">9.1</option>
                                <option value="9.2">9.2</option>
                                <option value="9.3">9.3</option>
                                <option value="9.4">9.4</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Jenis Penilaian</label>
                            <select id="jenisPenilaian" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                <option value="Harian">Harian</option>
                                <option value="Tugas">Tugas</option>
                                <option value="Bab">Bab</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-300 mb-2">Keterangan</label>
                            <input type="text" id="keteranganPenilaian" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Contoh: Ulangan Harian Bab 1">
                        </div>
                    </div>
                    <button onclick="loadPenilaian()" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold mb-6">
                        <i class="fas fa-search mr-2"></i>Muat Data Siswa
                    </button>
                </div>
                
                <div id="penilaianContainer" class="bg-gray-800 rounded-xl p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-white">Input Nilai</h3>
                        <button onclick="simpanPenilaian()" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                            <span class="btn-text"><i class="fas fa-save mr-2"></i>Simpan Nilai</span>
                            <span class="btn-loading hidden"><div class="loading mr-2"></div>Menyimpan...</span>
                        </button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead>
                                <tr class="border-b border-gray-700">
                                    <th class="p-3 text-gray-300">No</th>
                                    <th class="p-3 text-gray-300">Nama Siswa</th>
                                    <th class="p-3 text-gray-300">Nilai (0-100)</th>
                                </tr>
                            </thead>
                            <tbody id="penilaianTable">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="rekapanPage" class="page-content hidden">
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-white mb-2">Rekapan Data</h2>
                    <p class="text-gray-400">Lihat laporan dan statistik</p>
                </div>
                <div class="bg-gray-800 rounded-xl p-6 mb-8">
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="showRekapTab('absensi')" id="tabAbsensi" class="px-6 py-3 bg-purple-600 text-white rounded-lg font-semibold">Rekapan Absensi</button>
                        <button onclick="showRekapTab('kehadiran')" id="tabKehadiran" class="px-6 py-3 bg-gray-700 text-gray-300 rounded-lg font-semibold">Total Kehadiran</button>
                    </div>
                    
                    <div id="rekapAbsensiTab">
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                                <select id="kelasRekapAbsensi" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="7.1">7.1</option>
                                    <option value="7.2">7.2</option>
                                    <option value="7.3">7.3</option>
                                    <option value="7.4">7.4</option>
                                    <option value="8.1">8.1</option>
                                    <option value="8.2">8.2</option>
                                    <option value="8.3">8.3</option>
                                    <option value="8.4">8.4</option>
                                    <option value="9.1">9.1</option>
                                    <option value="9.2">9.2</option>
                                    <option value="9.3">9.3</option>
                                    <option value="9.4">9.4</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Jenis Absensi</label>
                                <select id="jenisAbsensiRekap" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="Wali Kelas">Wali Kelas</option>
                                    <option value="Guru Mapel">Guru Mapel</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Periode</label>
                                <select id="periodeRekap" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="harian">Harian</option>
                                    <option value="bulanan">Bulanan</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Tanggal/Bulan</label>
                                <input type="date" id="tanggalRekapAbsensi" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                        </div>
                        <div class="flex flex-wrap gap-4">
                            <button onclick="loadRekapAbsensi()" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold">
                                <i class="fas fa-search mr-2"></i>Tampilkan Rekap
                            </button>
                            <button onclick="testDatabaseConnection()" class="bg-blue-600 hover:bg-blue-700 px-6 py-3 rounded-lg text-white font-semibold transition-colors duration-200">
                                <i class="fas fa-database mr-2"></i>Test Database
                            </button>
                            <button onclick="cetakRekap()" class="bg-green-600 hover:bg-green-700 px-6 py-3 rounded-lg text-white font-semibold transition-colors duration-200">
                                <i class="fas fa-print mr-2"></i>Cetak
                            </button>
                        </div>
                    </div>
                    
                    <div id="rekapKehadiranTab" class="hidden">
                         <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                             <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Kelas</label>
                                <select id="kelasRekapKehadiran" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                                    <option value="7.1">7.1</option>
                                    <option value="7.2">7.2</option>
                                    <option value="7.3">7.3</option>
                                    <option value="7.4">7.4</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Bulan</label>
                                <input type="month" id="bulanRekap" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                            </div>
                            <div>
                                <button onclick="loadTotalKehadiran()" class="btn-primary w-full px-6 py-3 rounded-lg text-white font-semibold mt-7">
                                    <i class="fas fa-search mr-2"></i>Tampilkan Total
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="rekapContainer" class="bg-gray-800 rounded-xl p-6">
                    <h3 class="text-xl font-semibold text-white mb-6">Hasil Rekapan</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead id="rekapThead">
                                </thead>
                            <tbody id="rekapTbody">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyR66v53d9eJm5b-fD3W1s4XzGvY2aJ2d7C8j9kL0vN0zX3p1o2R-t7A6bI5n-O9e8C/exec';

        // --- UTILITY FUNCTIONS ---
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = 'notification'; // Reset classes
            notification.classList.add(type);
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function toggleLoading(button, isLoading) {
            const btnText = button.querySelector('.btn-text');
            const btnLoading = button.querySelector('.btn-loading');
            if (isLoading) {
                button.disabled = true;
                btnText.classList.add('hidden');
                btnLoading.classList.remove('hidden');
            } else {
                button.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        }
        
        // --- PAGE NAVIGATION ---
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden', 'animate-fade-in');
            });
            
            const targetPage = document.getElementById(pageId + 'Page');
            if(targetPage) {
                targetPage.classList.remove('hidden');
                // Trigger reflow to restart animation
                void targetPage.offsetWidth; 
                targetPage.classList.add('animate-fade-in');
            }
            
            let title = pageId.charAt(0).toUpperCase() + pageId.slice(1).replace('-', ' ');
            document.getElementById('pageTitle').textContent = title;

            // Load data for specific pages
            if (pageId === 'agenda-guru') loadAgenda();
            if (pageId === 'jurnal-guru') loadJurnal();
            if (pageId === 'siswa') loadDataSiswa();
            
            closeSidebar();
        }

        function closeSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.add('-translate-x-full');
            document.getElementById('mainContent').classList.remove('md:ml-64');
        }

        // --- AUTHENTICATION ---
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === 'admin' && password === 'admin') {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                showPage('beranda');
                localStorage.setItem('isLoggedIn', 'true');
            } else {
                showNotification('Username atau password salah', 'error');
            }
        });

        function logout() {
            localStorage.removeItem('isLoggedIn');
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
        }

        // Check login status on page load
        if (localStorage.getItem('isLoggedIn') === 'true') {
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('mainApp').classList.remove('hidden');
            showPage('beranda');
        }

        // --- AGENDA GURU ---
        document.getElementById('agendaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            toggleLoading(button, true);

            const formData = new FormData();
            formData.append('action', 'addAgenda');
            formData.append('tanggal', document.getElementById('agendaTanggal').value);
            formData.append('waktu', document.getElementById('agendaWaktu').value);
            formData.append('mapel', document.getElementById('agendaMapel').value);
            formData.append('kelas', document.getElementById('agendaKelas').value);
            formData.append('materi', document.getElementById('agendaMateri').value);
            formData.append('jenis', document.getElementById('agendaJenis').value);
            
            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if(data.result === 'success') {
                        showNotification('Agenda berhasil ditambahkan');
                        loadAgenda();
                        e.target.reset();
                    } else {
                        showNotification('Gagal menambahkan agenda: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'))
                .finally(() => toggleLoading(button, false));
        });

        function loadAgenda() {
            fetch(`${scriptURL}?action=getAgenda`)
                .then(response => response.json())
                .then(data => {
                    const agendaList = document.getElementById('agendaList');
                    agendaList.innerHTML = '';
                    if (data.length === 0) {
                        agendaList.innerHTML = `<p class="text-gray-400">Belum ada agenda.</p>`;
                        return;
                    }
                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'bg-gray-700 p-4 rounded-lg flex justify-between items-center';
                        div.innerHTML = `
                            <div>
                                <p class="font-semibold text-white">${item.materi}</p>
                                <p class="text-sm text-gray-400">${item.kelas} | ${new Date(item.tanggal).toLocaleDateString('id-ID')} | ${item.waktu}</p>
                            </div>
                            <button onclick="deleteAgenda('${item.id}')" class="text-red-400 hover:text-red-200"><i class="fas fa-trash"></i></button>
                        `;
                        agendaList.appendChild(div);
                    });
                })
                .catch(error => showNotification('Gagal memuat agenda: ' + error.message, 'error'));
        }

        function deleteAgenda(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus agenda ini?')) return;
            
            const formData = new FormData();
            formData.append('action', 'deleteAgenda');
            formData.append('id', id);

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Agenda berhasil dihapus');
                        loadAgenda();
                    } else {
                        showNotification('Gagal menghapus agenda: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'));
        }
        
        // --- JURNAL GURU ---
        document.getElementById('jurnalForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            toggleLoading(button, true);

            const formData = new FormData();
            formData.append('action', 'addJurnal');
            formData.append('tanggal', document.getElementById('jurnalTanggal').value);
            formData.append('jam', document.getElementById('jurnalJam').value);
            formData.append('mapel', document.getElementById('jurnalMapel').value);
            formData.append('kelas', document.getElementById('jurnalKelas').value);
            formData.append('materi', document.getElementById('jurnalMateri').value);
            formData.append('hadir', document.getElementById('jurnalHadir').value);
            formData.append('tidakHadir', document.getElementById('jurnalTidakHadir').value);
            formData.append('catatan', document.getElementById('jurnalCatatan').value);
            
            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if(data.result === 'success') {
                        showNotification('Jurnal berhasil ditambahkan');
                        loadJurnal();
                        e.target.reset();
                    } else {
                        showNotification('Gagal menambahkan jurnal: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'))
                .finally(() => toggleLoading(button, false));
        });

        function loadJurnal() {
            fetch(`${scriptURL}?action=getJurnal`)
                .then(response => response.json())
                .then(data => {
                    const jurnalList = document.getElementById('jurnalList');
                    jurnalList.innerHTML = '';
                    if (data.length === 0) {
                        jurnalList.innerHTML = `<p class="text-gray-400">Belum ada jurnal.</p>`;
                        return;
                    }
                    data.forEach(item => {
                        const div = document.createElement('div');
                        div.className = 'bg-gray-700 p-4 rounded-lg';
                        div.innerHTML = `
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="font-semibold text-white">${item.materi}</p>
                                    <p class="text-sm text-gray-400">${item.kelas} | ${new Date(item.tanggal).toLocaleDateString('id-ID')} | Jam ke-${item.jam}</p>
                                    <p class="text-sm text-gray-300 mt-2">Hadir: ${item.hadir}, Tidak Hadir: ${item.tidakHadir}</p>
                                    ${item.catatan ? `<p class="text-sm text-yellow-300 mt-1">Catatan: ${item.catatan}</p>` : ''}
                                </div>
                                <button onclick="deleteJurnal('${item.id}')" class="text-red-400 hover:text-red-200"><i class="fas fa-trash"></i></button>
                            </div>
                        `;
                        jurnalList.appendChild(div);
                    });
                })
                .catch(error => showNotification('Gagal memuat jurnal: ' + error.message, 'error'));
        }

        function deleteJurnal(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus jurnal ini?')) return;
            
            const formData = new FormData();
            formData.append('action', 'deleteJurnal');
            formData.append('id', id);

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Jurnal berhasil dihapus');
                        loadJurnal();
                    } else {
                        showNotification('Gagal menghapus jurnal: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'));
        }

        // --- DATA SISWA ---
        document.getElementById('siswaForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const button = e.target.querySelector('button[type="submit"]');
            toggleLoading(button, true);
            
            const formData = new FormData();
            formData.append('action', 'addSiswa');
            formData.append('nama', document.getElementById('namaSiswa').value);
            formData.append('kelas', document.getElementById('kelasSiswa').value);
            
            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if(data.result === 'success') {
                        showNotification('Siswa berhasil ditambahkan');
                        loadDataSiswa();
                        e.target.reset();
                    } else {
                        showNotification('Gagal menambahkan siswa: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'))
                .finally(() => toggleLoading(button, false));
        });

        function loadDataSiswa() {
            const filterKelas = document.getElementById('filterKelas').value;
            fetch(`${scriptURL}?action=getSiswa&kelas=${filterKelas}`)
                .then(response => response.json())
                .then(data => {
                    const tableBody = document.getElementById('siswaTableBody');
                    tableBody.innerHTML = '';
                    if (data.length === 0) {
                        tableBody.innerHTML = `<tr><td colspan="4" class="text-center p-4 text-gray-400">Tidak ada data siswa.</td></tr>`;
                        return;
                    }
                    data.forEach((siswa, index) => {
                        const tr = document.createElement('tr');
                        tr.className = 'border-b border-gray-700';
                        tr.innerHTML = `
                            <td class="p-3">${index + 1}</td>
                            <td class="p-3">${siswa.nama}</td>
                            <td class="p-3">${siswa.kelas}</td>
                            <td class="p-3">
                                <button onclick="deleteSiswa('${siswa.id}')" class="text-red-400 hover:text-red-200"><i class="fas fa-trash"></i></button>
                            </td>
                        `;
                        tableBody.appendChild(tr);
                    });
                })
                .catch(error => showNotification('Gagal memuat data siswa: ' + error.message, 'error'));
        }

        function deleteSiswa(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data siswa ini?')) return;
            
            const formData = new FormData();
            formData.append('action', 'deleteSiswa');
            formData.append('id', id);

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Data siswa berhasil dihapus');
                        loadDataSiswa();
                    } else {
                        showNotification('Gagal menghapus data siswa: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'));
        }

        // --- ABSENSI ---
        function loadAbsensi() {
            const kelas = document.getElementById('kelasAbsen').value;
            fetch(`${scriptURL}?action=getSiswa&kelas=${kelas}`)
                .then(response => response.json())
                .then(data => {
                    const siswaGrid = document.getElementById('siswaGrid');
                    siswaGrid.innerHTML = '';
                    if (data.length === 0) {
                        showNotification(`Tidak ada siswa di kelas ${kelas}`, 'error');
                        document.getElementById('absensiContainer').classList.add('hidden');
                        return;
                    }
                    data.forEach(siswa => {
                        const card = document.createElement('div');
                        card.className = 'bg-gray-700 p-4 rounded-lg flex flex-col justify-between';
                        card.dataset.id = siswa.id;
                        card.dataset.nama = siswa.nama;
                        card.innerHTML = `
                            <p class="font-semibold text-white mb-4">${siswa.nama}</p>
                            <div class="flex space-x-2 status-buttons">
                                <button onclick="setStatus(this, 'hadir')" class="flex-1 p-2 rounded status-hadir">H</button>
                                <button onclick="setStatus(this, 'sakit')" class="flex-1 p-2 rounded status-sakit">S</button>
                                <button onclick="setStatus(this, 'izin')" class="flex-1 p-2 rounded status-izin">I</button>
                                <button onclick="setStatus(this, 'alfa')" class="flex-1 p-2 rounded status-alfa">A</button>
                            </div>
                        `;
                        siswaGrid.appendChild(card);
                    });
                    document.getElementById('absensiContainer').classList.remove('hidden');
                    hadirSemua(); // Set default to 'hadir'
                })
                .catch(error => showNotification('Gagal memuat data siswa untuk absensi: ' + error.message, 'error'));
        }

        function setStatus(button, status) {
            const buttons = button.parentElement.querySelectorAll('button');
            buttons.forEach(btn => btn.classList.remove('ring-2', 'ring-white'));
            button.classList.add('ring-2', 'ring-white');
            button.closest('.bg-gray-700').dataset.status = status;
        }

        function hadirSemua() {
            document.querySelectorAll('#siswaGrid .status-buttons').forEach(group => {
                const hadirButton = group.querySelector('.status-hadir');
                setStatus(hadirButton, 'hadir');
            });
        }

        function simpanAbsensi() {
            const button = document.querySelector('#absensiContainer button[onclick="simpanAbsensi()"]');
            toggleLoading(button, true);

            const jenisAbsen = document.getElementById('jenisAbsen').value;
            const kelas = document.getElementById('kelasAbsen').value;
            const tanggal = document.getElementById('tanggalAbsen').value;

            if (!tanggal) {
                showNotification('Silakan pilih tanggal terlebih dahulu.', 'error');
                toggleLoading(button, false);
                return;
            }

            const absensiData = [];
            document.querySelectorAll('#siswaGrid .bg-gray-700').forEach(card => {
                absensiData.push({
                    id: card.dataset.id,
                    nama: card.dataset.nama,
                    status: card.dataset.status || 'hadir'
                });
            });

            const formData = new FormData();
            formData.append('action', 'saveAbsensi');
            formData.append('jenisAbsen', jenisAbsen);
            formData.append('kelas', kelas);
            formData.append('tanggal', tanggal);
            formData.append('data', JSON.stringify(absensiData));

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Absensi berhasil disimpan');
                    } else {
                        showNotification('Gagal menyimpan absensi: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'))
                .finally(() => toggleLoading(button, false));
        }

        // --- PENILAIAN ---
        function loadPenilaian() {
            const kelas = document.getElementById('kelasPenilaian').value;
            fetch(`${scriptURL}?action=getSiswa&kelas=${kelas}`)
                .then(response => response.json())
                .then(data => {
                    const penilaianTable = document.getElementById('penilaianTable');
                    penilaianTable.innerHTML = '';
                    if (data.length === 0) {
                        showNotification(`Tidak ada siswa di kelas ${kelas}`, 'error');
                        document.getElementById('penilaianContainer').classList.add('hidden');
                        return;
                    }
                    data.forEach((siswa, index) => {
                        const tr = document.createElement('tr');
                        tr.className = 'border-b border-gray-700';
                        tr.dataset.id = siswa.id;
                        tr.dataset.nama = siswa.nama;
                        tr.innerHTML = `
                            <td class="p-3">${index + 1}</td>
                            <td class="p-3">${siswa.nama}</td>
                            <td class="p-3">
                                <input type="number" min="0" max="100" class="w-24 px-2 py-1 bg-gray-600 border border-gray-500 rounded-lg">
                            </td>
                        `;
                        penilaianTable.appendChild(tr);
                    });
                    document.getElementById('penilaianContainer').classList.remove('hidden');
                })
                .catch(error => showNotification('Gagal memuat data siswa untuk penilaian: ' + error.message, 'error'));
        }

        function simpanPenilaian() {
            const button = document.querySelector('#penilaianContainer button[onclick="simpanPenilaian()"]');
            toggleLoading(button, true);

            const kelas = document.getElementById('kelasPenilaian').value;
            const jenis = document.getElementById('jenisPenilaian').value;
            const keterangan = document.getElementById('keteranganPenilaian').value;

            if (!keterangan) {
                showNotification('Silakan isi keterangan penilaian.', 'error');
                toggleLoading(button, false);
                return;
            }

            const penilaianData = [];
            document.querySelectorAll('#penilaianTable tr').forEach(row => {
                const nilai = row.querySelector('input').value;
                if (nilai) { // Only save if a grade is entered
                    penilaianData.push({
                        id: row.dataset.id,
                        nama: row.dataset.nama,
                        nilai: nilai
                    });
                }
            });

            if (penilaianData.length === 0) {
                showNotification('Tidak ada nilai yang diinput.', 'error');
                toggleLoading(button, false);
                return;
            }
            
            const formData = new FormData();
            formData.append('action', 'savePenilaian');
            formData.append('kelas', kelas);
            formData.append('jenis', jenis);
            formData.append('keterangan', keterangan);
            formData.append('data', JSON.stringify(penilaianData));

            fetch(scriptURL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        showNotification('Nilai berhasil disimpan');
                        document.getElementById('penilaianContainer').classList.add('hidden');
                        document.getElementById('keteranganPenilaian').value = '';
                    } else {
                        showNotification('Gagal menyimpan nilai: ' + data.message, 'error');
                    }
                })
                .catch(error => showNotification('Error: ' + error.message, 'error'))
                .finally(() => toggleLoading(button, false));
        }

        // --- REKAPAN ---
        function showRekapTab(tabName) {
            if (tabName === 'absensi') {
                document.getElementById('rekapAbsensiTab').style.display = 'block';
                document.getElementById('rekapKehadiranTab').style.display = 'none';
                document.getElementById('tabAbsensi').classList.replace('bg-gray-700', 'bg-purple-600');
                document.getElementById('tabAbsensi').classList.replace('text-gray-300', 'text-white');
                document.getElementById('tabKehadiran').classList.replace('bg-purple-600', 'bg-gray-700');
                document.getElementById('tabKehadiran').classList.replace('text-white', 'text-gray-300');
            } else {
                document.getElementById('rekapAbsensiTab').style.display = 'none';
                document.getElementById('rekapKehadiranTab').style.display = 'block';
                document.getElementById('tabAbsensi').classList.replace('bg-purple-600', 'bg-gray-700');
                document.getElementById('tabAbsensi').classList.replace('text-white', 'text-gray-300');
                document.getElementById('tabKehadiran').classList.replace('bg-gray-700', 'bg-purple-600');
                document.getElementById('tabKehadiran').classList.replace('text-gray-300', 'text-white');
            }
        }
        
        function loadRekapAbsensi() {
            const kelas = document.getElementById('kelasRekapAbsensi').value;
            const jenis = document.getElementById('jenisAbsensiRekap').value;
            const periode = document.getElementById('periodeRekap').value;
            const tanggal = document.getElementById('tanggalRekapAbsensi').value;

            if (!tanggal) {
                showNotification('Silakan pilih tanggal.', 'error');
                return;
            }

            fetch(`${scriptURL}?action=getRekapAbsensi&kelas=${kelas}&jenis=${jenis}&periode=${periode}&tanggal=${tanggal}`)
                .then(response => response.json())
                .then(data => {
                    const thead = document.getElementById('rekapThead');
                    const tbody = document.getElementById('rekapTbody');
                    thead.innerHTML = '';
                    tbody.innerHTML = '';
                    
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    if (data.headers.length <= 2) { // Only 'Nama' and 'ID'
                        tbody.innerHTML = `<tr><td colspan="2" class="p-3 text-center text-gray-400">Tidak ada data absensi pada periode ini.</td></tr>`;
                        return;
                    }

                    // Build header
                    let headerHtml = '<tr>';
                    data.headers.forEach(header => {
                        if(header !== 'id') headerHtml += `<th class="p-3 text-gray-300">${header}</th>`;
                    });
                    headerHtml += '</tr>';
                    thead.innerHTML = headerHtml;

                    // Build body
                    let bodyHtml = '';
                    data.rows.forEach(row => {
                        bodyHtml += '<tr class="border-b border-gray-700">';
                        for (const key in row) {
                            if (key !== 'id') {
                                bodyHtml += `<td class="p-3">${row[key] || ''}</td>`;
                            }
                        }
                        bodyHtml += '</tr>';
                    });
                    tbody.innerHTML = bodyHtml;
                })
                .catch(error => {
                    showNotification('Gagal memuat rekap absensi: ' + error.message, 'error');
                    document.getElementById('rekapTbody').innerHTML = `<tr><td colspan="1" class="p-3 text-center text-red-400">${error.message}</td></tr>`;
                });
        }
        
        function cetakRekap() {
            const table = document.getElementById('rekapContainer').cloneNode(true);
            const kelas = document.getElementById('kelasRekapAbsensi').value;
            const tanggal = document.getElementById('tanggalRekapAbsensi').value;

            // Remove action buttons from cloned table if any
            table.querySelectorAll('button').forEach(btn => btn.remove());
            
            const newWindow = window.open('', '', 'height=800,width=1200');
            newWindow.document.write('<html><head><title>Cetak Rekap Absensi</title>');
            newWindow.document.write('<style>body{font-family:sans-serif;margin:20px;} table{width:100%;border-collapse:collapse;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} th{background-color:#f2f2f2;} h2,h3{text-align:center;}</style>');
            newWindow.document.write('</head><body>');
            newWindow.document.write(`<h2>REKAP ABSENSI</h2><h3>Kelas: ${kelas} | Tanggal: ${tanggal}</h3>`);
            newWindow.document.write(table.innerHTML);
            newWindow.document.write('</body></html>');
            newWindow.document.close();
            newWindow.print();
        }
        
        // --- EVENT LISTENERS ---
        document.addEventListener('DOMContentLoaded', function() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('-translate-x-full');
                if (!sidebar.classList.contains('-translate-x-full')) {
                   document.getElementById('mainContent').classList.add('md:ml-64');
                } else {
                   document.getElementById('mainContent').classList.remove('md:ml-64');
                }
            });

            // Set default date for inputs
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tanggalAbsen').value = today;
            document.getElementById('tanggalRekapAbsensi').value = today;
            document.getElementById('agendaTanggal').value = today;
            document.getElementById('jurnalTanggal').value = today;
            
            // Add close button event listener
            document.getElementById('sidebarClose').addEventListener('click', closeSidebar);
        });

        // Responsive sidebar handling - simplified
        window.addEventListener('resize', function() {
            // Sidebar behavior is now consistent across all devices
            // Always starts hidden and can be toggled with hamburger button
        });
    </script>
</body>
</html>
